ICONS=["alert-avalanche-danger.svg",
	"alert-falling-rocks.svg",
	"barometer.svg",
	"beanie.svg",
	"celsius.svg",
	"clear-day.svg",
	"clear-night.svg",
	"cloud-down.svg",
	"cloud-up.svg",
	"cloudy.svg",
	"code-green.svg",
	"code-orange.svg",
	"code-red.svg",
	"code-yellow.svg",
	"compass.svg",
	"drizzle.svg",
	"dust-day.svg",
	"dust-night.svg",
	"dust-wind.svg",
	"dust.svg",
	"extreme-day-drizzle.svg",
	"extreme-day-fog.svg",
	"extreme-day-hail.svg",
	"extreme-day-haze.svg",
	"extreme-day-rain.svg",
	"extreme-day-sleet.svg",
	"extreme-day-smoke.svg",
	"extreme-day-snow.svg",
	"extreme-day.svg",
	"extreme-drizzle.svg",
	"extreme-fog.svg",
	"extreme-hail.svg",
	"extreme-haze.svg",
	"extreme-night-drizzle.svg",
	"extreme-night-fog.svg",
	"extreme-night-hail.svg",
	"extreme-night-haze.svg",
	"extreme-night-rain.svg",
	"extreme-night-sleet.svg",
	"extreme-night-smoke.svg",
	"extreme-night-snow.svg",
	"extreme-night.svg",
	"extreme-rain.svg",
	"extreme-sleet.svg",
	"extreme-smoke.svg",
	"extreme-snow.svg",
	"extreme.svg",
	"fahrenheit.svg",
	"falling-stars.svg",
	"flag-gale-warning.svg",
	"flag-hurricane-warning.svg",
	"flag-small-craft-advisory.svg",
	"flag-storm-warning.svg",
	"fog-day.svg",
	"fog-night.svg",
	"fog.svg",
	"glove.svg",
	"hail.svg",
	"haze-day.svg",
	"haze-night.svg",
	"haze.svg",
	"horizon.svg",
	"humidity.svg",
	"hurricane.svg",
	"lightning-bolt.svg",
	"mist.svg",
	"moon-first-quarter.svg",
	"moon-full.svg",
	"moon-last-quarter.svg",
	"moon-new.svg",
	"moon-waning-crescent.svg",
	"moon-waning-gibbous.svg",
	"moon-waxing-crescent.svg",
	"moon-waxing-gibbous.svg",
	"moonrise.svg",
	"moonset.svg",
	"not-available.svg",
	"overcast-day-drizzle.svg",
	"overcast-day-fog.svg",
	"overcast-day-hail.svg",
	"overcast-day-haze.svg",
	"overcast-day-rain.svg",
	"overcast-day-sleet.svg",
	"overcast-day-smoke.svg",
	"overcast-day-snow.svg",
	"overcast-day.svg",
	"overcast-drizzle.svg",
	"overcast-fog.svg",
	"overcast-hail.svg",
	"overcast-haze.svg",
	"overcast-night-drizzle.svg",
	"overcast-night-fog.svg",
	"overcast-night-hail.svg",
	"overcast-night-haze.svg",
	"overcast-night-rain.svg",
	"overcast-night-sleet.svg",
	"overcast-night-smoke.svg",
	"overcast-night-snow.svg",
	"overcast-night.svg",
	"overcast-rain.svg",
	"overcast-sleet.svg",
	"overcast-smoke.svg",
	"overcast-snow.svg",
	"overcast.svg",
	"partly-cloudy-day-drizzle.svg",
	"partly-cloudy-day-fog.svg",
	"partly-cloudy-day-hail.svg",
	"partly-cloudy-day-haze.svg",
	"partly-cloudy-day-rain.svg",
	"partly-cloudy-day-sleet.svg",
	"partly-cloudy-day-smoke.svg",
	"partly-cloudy-day-snow.svg",
	"partly-cloudy-day.svg",
	"partly-cloudy-night-drizzle.svg",
	"partly-cloudy-night-fog.svg",
	"partly-cloudy-night-hail.svg",
	"partly-cloudy-night-haze.svg",
	"partly-cloudy-night-rain.svg",
	"partly-cloudy-night-sleet.svg",
	"partly-cloudy-night-smoke.svg",
	"partly-cloudy-night-snow.svg",
	"partly-cloudy-night.svg",
	"pollen-flower.svg",
	"pollen-grass.svg",
	"pollen-tree.svg",
	"pollen.svg",
	"pressure-high-alt.svg",
	"pressure-high.svg",
	"pressure-low-alt.svg",
	"pressure-low.svg",
	"rain.svg",
	"rainbow-clear.svg",
	"rainbow.svg",
	"raindrop-measure.svg",
	"raindrop.svg",
	"raindrops.svg",
	"sleet.svg",
	"smoke-particles.svg",
	"smoke.svg",
	"snow.svg",
	"snowflake.svg",
	"snowman.svg",
	"solar-eclipse.svg",
	"star.svg",
	"starry-night.svg",
	"sun-hot.svg",
	"sunrise.svg",
	"sunset.svg",
	"thermometer-celsius.svg",
	"thermometer-colder.svg",
	"thermometer-fahrenheit.svg",
	"thermometer-glass-celsius.svg",
	"thermometer-glass-fahrenheit.svg",
	"thermometer-glass.svg",
	"thermometer-mercury-cold.svg",
	"thermometer-mercury.svg",
	"thermometer-moon.svg",
	"thermometer-raindrop.svg",
	"thermometer-snow.svg",
	"thermometer-sun.svg",
	"thermometer-warmer.svg",
	"thermometer-water.svg",
	"thermometer.svg",
	"thunderstorms-day-extreme-rain.svg",
	"thunderstorms-day-extreme-snow.svg",
	"thunderstorms-day-extreme.svg",
	"thunderstorms-day-overcast-rain.svg",
	"thunderstorms-day-overcast-snow.svg",
	"thunderstorms-day-overcast.svg",
	"thunderstorms-day-rain.svg",
	"thunderstorms-day-snow.svg",
	"thunderstorms-day.svg",
	"thunderstorms-extreme-rain.svg",
	"thunderstorms-extreme-snow.svg",
	"thunderstorms-extreme.svg",
	"thunderstorms-night-extreme-rain.svg",
	"thunderstorms-night-extreme-snow.svg",
	"thunderstorms-night-extreme.svg",
	"thunderstorms-night-overcast-rain.svg",
	"thunderstorms-night-overcast-snow.svg",
	"thunderstorms-night-overcast.svg",
	"thunderstorms-night-rain.svg",
	"thunderstorms-night-snow.svg",
	"thunderstorms-night.svg",
	"thunderstorms-overcast-rain.svg",
	"thunderstorms-overcast-snow.svg",
	"thunderstorms-overcast.svg",
	"thunderstorms-rain.svg",
	"thunderstorms-snow.svg",
	"thunderstorms.svg",
	"tide-high.svg",
	"tide-low.svg",
	"time-afternoon.svg",
	"time-evening.svg",
	"time-late-afternoon.svg",
	"time-late-evening.svg",
	"time-late-morning.svg",
	"time-late-night.svg",
	"time-morning.svg",
	"time-night.svg",
	"tornado.svg",
	"umbrella-wind-alt.svg",
	"umbrella-wind.svg",
	"umbrella.svg",
	"uv-index-1.svg",
	"uv-index-10.svg",
	"uv-index-11.svg",
	"uv-index-2.svg",
	"uv-index-3.svg",
	"uv-index-4.svg",
	"uv-index-5.svg",
	"uv-index-6.svg",
	"uv-index-7.svg",
	"uv-index-8.svg",
	"uv-index-9.svg",
	"uv-index.svg",
	"wind-alert.svg",
	"wind-beaufort-0.svg",
	"wind-beaufort-1.svg",
	"wind-beaufort-10.svg",
	"wind-beaufort-11.svg",
	"wind-beaufort-12.svg",
	"wind-beaufort-2.svg",
	"wind-beaufort-3.svg",
	"wind-beaufort-4.svg",
	"wind-beaufort-5.svg",
	"wind-beaufort-6.svg",
	"wind-beaufort-7.svg",
	"wind-beaufort-8.svg",
	"wind-beaufort-9.svg",
	"wind-offshore.svg",
	"wind-onshore.svg",
	"wind-snow.svg",
	"wind.svg",
	"windsock-weak.svg",
	"windsock.svg"]
	
APIKEY='f26b9b0aaefc8ffb633e07e4e4d7ddb8'
gridForecastForPointLocation='https://api.weather.gov/points/{},{}'
currentWeather='https://api.openweathermap.org/data/2.5/weather?lat={}&lon={}&appid={}'
vsForecastURL="https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/{},{}?key={}&datestart=next7days&include=days"
vsForecastURLDates='https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/15857/2025-01-12/2020-01-22?key={}'
vsAPIKey="7ZEPRG9AAW48YDYZSLXEBP6G3"
sunriseURL="https://api.sunrisesunset.io/json?lat={}&lng={}&date={}"

def getSunrise(lng,lat,dateString):
	
	source=system.net.httpGet(sunriseURL.format(lat,lng,dateString))
	
	return system.util.jsonDecode(source)


def getGridForcast(lng,lat):
	source=system.net.httpGet(gridForecastForPointLocation.format(lng,lat))
	
	return system.util.jsonDecode(source)

def generalAPICall(url):
	source=system.net.httpGet(url)
	return system.util.jsonDecode(source)

def getCurrentWeather(lat,lng):
	source=system.net.httpGet(currentWeather.format(lat,lng, APIKEY))
	return system.util.jsonDecode(source)

def getVSForecast(lat,lng):
	source=system.net.httpGet(vsForecastURL.format(lat,lng, vsAPIKey))
	return system.util.jsonDecode(source)

def getVSForecastDates():
	source=system.net.httpGet(vsForecastURLDates.format(vsAPIKey))
	return system.util.jsonDecode(source)
	
def select_weather_icon_detailed(cloudiness, precip_percent, precipType, isDay):
	"""
	Selects the appropriate weather icon based on detailed rules combining cloudiness, precipitation, and conditions.
	
	:param cloudiness: Percentage of cloud coverage (0-100).
	:param precip_percent: Percentage chance of precipitation (0-100).
	:param conditions: String describing weather conditions (e.g., "Snow", "Partially cloudy").
	:return: File path of the chosen weather icon.
	"""
	def getPrecipIcon(listOfOptions):
		if precip_percent<20:
			return listOfOptions[0]
		else:
			precip_set = set(precipType)  # Convert to set for efficient checks
			
			# Check for "mix" or "sleet" in the list
			if "mix" in precip_set or "sleet" in precip_set or "ice" in precip_set:
				return listOfOptions[1]
			# Check for both "rain" and "snow" in the list
			elif "rain" in precip_set and "snow" in precip_set:
				return listOfOptions[1]
			# Check for "rain" in the list
			elif "rain" in precip_set:
				return listOfOptions[2]
			# Check for "snow" in the list
			elif "snow" in precip_set:
				return listOfOptions[3]
			# Default case (if none of the above conditions are met)
			else:
				return listOfOptions[0]
	
	
	if cloudiness<25:
		if isDay:
			listOfOptions=["clear-day","partly-cloudy-day-sleet","partly-cloudy-day-rain","partly-cloudy-day-snow"]
			icon=getPrecipIcon(listOfOptions)
		else:
			listOfOptions=["clear-night","partly-cloudy-night-sleet","partly-cloudy-night-rain","partly-cloudy-night-snow"]
			icon=getPrecipIcon(listOfOptions)
	elif cloudiness<40:
		if isDay:
			listOfOptions=["partly-cloudy-day","partly-cloudy-day-sleet","partly-cloudy-day-rain","partly-cloudy-day-snow"]
			icon=getPrecipIcon(listOfOptions)
		else:
			listOfOptions=["partly-cloudy-night","partly-cloudy-night-sleet","partly-cloudy-night-rain","partly-cloudy-night-snow"]
			icon=getPrecipIcon(listOfOptions)
	elif cloudiness<60:
		if isDay:
			listOfOptions=["overcast-day","overcast-day-sleet","overcast-day-rain","overcast-day-snow"]
			icon=getPrecipIcon(listOfOptions)
		else:
			listOfOptions=["overcast-night","overcast-night-sleet","overcast-night-rain","overcast-night-snow"]
			icon=getPrecipIcon(listOfOptions)
	elif cloudiness<80:
		if isDay:
			listOfOptions=["extreme-day","extreme-day-sleet","extreme-day-rain","extreme-day-snow"]
			icon=getPrecipIcon(listOfOptions)
		else:
			listOfOptions=["extreme-night","extreme-night-sleet","extreme-night-rain","extreme-night-snow"]
			icon=getPrecipIcon(listOfOptions)
	elif cloudiness>=80:
			listOfOptions=["extreme","extreme-sleet","extreme-rain","extreme-snow"]
			icon=getPrecipIcon(listOfOptions)

	# Return the formatted path for the selected icon
	return '/system/images/WeatherIcons/{icon}.svg'.format(icon=icon)
    
def convertTodegF(degC):
	return (degC * 1.8) + 32

def convert_length(input_value, input_unit, output_unit):
	# Conversion factors to meters
	to_meters = {
	    "mm": 0.001,
	    "cm": 0.01,
	    "m": 1.0,
	    "km": 1000.0,
	    "in": 0.0254,
	    "feet": 0.3048,
	    "yard": 0.9144,
	    "mile": 1609.344,
	}
	
	if input_unit not in to_meters:
	    raise ValueError("Unsupported input unit: {}".format(input_unit))
	if output_unit not in to_meters:
	    raise ValueError("Unsupported output unit: {}".format(output_unit))
	
	# Convert the input value to meters
	value_in_meters = input_value * to_meters[input_unit]
	
	# Convert from meters to the output unit
	output_value = value_in_meters / to_meters[output_unit]
	
	return output_value


def kmh_to_mph(kmh):
	mph = kmh * 0.621371
	return mph